/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package et.bo.screen.action;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import et.bo.screen.service.CustomMadeService;
import et.bo.screen.service.MarAnalysisService;
import excellence.common.page.PageInfo;
import excellence.common.page.PageTurning;
import excellence.framework.base.action.BaseAction;
import excellence.framework.base.dto.IBaseDTO;
import excellence.framework.base.dto.impl.DynaActionFormDTO;
/** 
 * MyEclipse Struts
 * Creation date: 06-26-2008
 * 
 * XDoclet definition:
 * @struts.action parameter="method" validate="true"
 * 
 */
public class CustomMadeAction extends BaseAction {
	/*
	 * Generated Methods
	 */
	private CustomMadeService cms;
	
	/**
	 * 金农市场分析主页面
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */	
	public ActionForward toCustomMadeMain(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		
		return mapping.findForward("main");
	}
	
	/**
	 * 金农市场分析查询页面
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward toCustomMadeQuery(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		
		return mapping.findForward("query");
	}
	
	/**
	 * 金农市场分析查询列表
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward toCustomMadeList(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		DynaActionFormDTO dto = (DynaActionFormDTO)form;
		String pageState = null;
        PageInfo pageInfo = null;
        pageState = (String)request.getParameter("pagestate");
        if (pageState==null) {
            pageInfo = new PageInfo();
        }else{
            PageTurning pageTurning = (PageTurning)request.getSession().getAttribute("phonepageTurning");
            pageInfo = pageTurning.getPage();
            pageInfo.setState(pageState);
            dto = (DynaActionFormDTO)pageInfo.getQl();
        }
        pageInfo.setPageSize(15);
       //取得list及条数
        List list = cms.customMadeInfoQuery(dto, pageInfo);
        int size = cms.getCustomMadeInfoSize();
       
        pageInfo.setRowCount(size);
        pageInfo.setQl(dto);
        request.setAttribute("list",list);
        PageTurning pt = new PageTurning(pageInfo,"",mapping,request);
        request.getSession().setAttribute("phonepageTurning",pt);
        
		return mapping.findForward("list");
	}
	
	public ActionForward toCustomMadeList2(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		
        List list = cms.customMadeInfoQuery2();
        request.setAttribute("list",list);
 
		return mapping.findForward("list2");
	}
	
	/**
	 * 金农市场分析详细页面
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward toCustomMadeLoad(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String type = request.getParameter("type");// 取出不同的操作标志
		request.setAttribute("opertype", type);
		
		if("insert".equals(type)) {
			return mapping.findForward("load");
		}
		if("detail".equals(type)) {
			String id = request.getParameter("id");
			IBaseDTO dto = cms.getCustomMadeInfo(id);
			request.setAttribute(mapping.getName(), dto);
			
			return mapping.findForward("load");
		} else if("update".equals(type)) {
			String id = request.getParameter("id");
			IBaseDTO dto = cms.getCustomMadeInfo(id);
			request.setAttribute(mapping.getName(), dto);
			
			return mapping.findForward("load");
		} else if("delete".equals(type)) {
			String id = request.getParameter("id");
			IBaseDTO dto = cms.getCustomMadeInfo(id);
			request.setAttribute(mapping.getName(), dto);
			
			return mapping.findForward("load");
		}
		return mapping.findForward("load");
	}
	
	/**
	 * 金农市场分析操作
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward toCustomMadeOper(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		DynaActionFormDTO dto = (DynaActionFormDTO)form;
		
		String type = request.getParameter("type");// 取出不同的操作标志
		request.setAttribute("opertype", type);
		
		if("insert".equals(type)) {
			boolean flag = cms.addCustomMade(dto);
			if(flag) {
				request.setAttribute("operSign", "添加成功");
				return mapping.findForward("load");
			}
		}
		if("update".equals(type)) {
			boolean flag = cms.updateCustomMade(dto);
			if(flag) {
				request.setAttribute("operSign", "修改成功");
				return mapping.findForward("load");
			}
		}
		if("delete".equals(type)) {
			boolean flag = cms.deleteCustomMade(dto);
			if(flag) {
				request.setAttribute("operSign", "删除成功");
				return mapping.findForward("load");
			}
		}
		return mapping.findForward("load");
	}

	public CustomMadeService getCms() {
		return cms;
	}

	public void setCms(CustomMadeService cms) {
		this.cms = cms;
	}

	
}